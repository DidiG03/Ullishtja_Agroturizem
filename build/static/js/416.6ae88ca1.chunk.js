"use strict";(self.webpackChunkullishtja_agroturizem=self.webpackChunkullishtja_agroturizem||[]).push([[416],{2416:(e,t,o)=>{o.r(t),o.d(t,{default:()=>r});var i=o(5043);o(8903);const r=()=>{(0,i.useEffect)(()=>{if(window.innerWidth<=768){e();["/images/ullishtja_logo.jpeg","/videos/dji-20240806130059-0020-d-poster.jpg","/videos/dji-20240806130609-0022-d-poster.jpg","/images/food.jpeg"].forEach(e=>{const t=new Image;t.src=e,t.setAttribute("fetchpriority","high")});document.querySelectorAll("img").forEach((e,t)=>{t<3?e.setAttribute("fetchpriority","high"):e.setAttribute("loading","lazy")}),document.body.style.setProperty("-webkit-overflow-scrolling","touch"),document.body.style.setProperty("overscroll-behavior","none"),document.body.style.setProperty("-webkit-transform","translateZ(0)"),document.body.style.setProperty("transform","translateZ(0)");const t=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));const t=getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-top")||"0px",o=getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom")||"0px";document.documentElement.style.setProperty("--safe-top",t),document.documentElement.style.setProperty("--safe-bottom",o)};t();const o=function(e,t){let o;return function(){const i=arguments,r=this;o||(e.apply(r,i),o=!0,setTimeout(()=>o=!1,t))}}(t,100),i=function(e,t){let o;return function(){const i=arguments,r=this;clearTimeout(o),o=setTimeout(()=>e.apply(r,i),t)}}(t,150);return window.addEventListener("resize",o,{passive:!0}),window.addEventListener("orientationchange",i,{passive:!0}),navigator.deviceMemory&&navigator.deviceMemory<=2&&document.documentElement.classList.add("low-memory-device"),"getBattery"in navigator&&navigator.getBattery().then(e=>{e.level<.2&&document.documentElement.classList.add("battery-saver-mode")}),()=>{window.removeEventListener("resize",o),window.removeEventListener("orientationchange",i)}}},[]);const e=async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/video-sw.js",{scope:"/videos/"});console.log("Video SW registered successfully:",e),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"activated"===t.state&&console.log("New video service worker activated")})})}catch(e){console.warn("Video SW registration failed:",e)}};return null}},8903:(e,t,o)=>{o.d(t,{A:()=>r});var i=o(9379);const r=new class{constructor(){this.preloadedVideos=new Map,this.preloadQueue=[],this.isPreloading=!1,this.networkInfo=this.getNetworkInfo(),this.deviceInfo=this.getDeviceInfo(),this.userBehavior=this.getUserBehavior(),this.setupNetworkMonitoring(),this.preloadCriticalVideos()}getNetworkInfo(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?{effectiveType:e.effectiveType||"4g",downlink:e.downlink||10,rtt:e.rtt||100,saveData:e.saveData||!1}:{effectiveType:"4g",downlink:10,rtt:100,saveData:!1}}getDeviceInfo(){const e=window.innerWidth,t=navigator.deviceMemory||4,o=navigator.hardwareConcurrency||4;return{isMobile:e<=768,isTablet:e>768&&e<=1024,isDesktop:e>1024,memory:t,hardwareConcurrency:o,isLowPower:o<=2||t<=2,pixelRatio:window.devicePixelRatio||1}}getUserBehavior(){const e=localStorage.getItem("video_user_behavior"),t={averageViewTime:3e4,scrollSpeed:"medium",interactionPatterns:[],preferredQuality:"auto",batteryOptimization:!1};return e?(0,i.A)((0,i.A)({},t),JSON.parse(e)):t}setupNetworkMonitoring(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&e.addEventListener("change",()=>{this.networkInfo=this.getNetworkInfo(),this.adjustPreloadingStrategy()}),"getBattery"in navigator&&navigator.getBattery().then(e=>{const t=()=>{this.userBehavior.batteryOptimization=e.level<.2||!e.charging};e.addEventListener("levelchange",t),e.addEventListener("chargingchange",t),t()})}adjustPreloadingStrategy(){const{effectiveType:e,saveData:t,downlink:o}=this.networkInfo,{isLowPower:i}=this.deviceInfo,{batteryOptimization:r}=this.userBehavior;t||r||"slow-2g"===e||"2g"===e?this.preloadQueue=[]:("3g"===e||o<5||i)&&(this.preloadQueue=this.preloadQueue.slice(0,2))}getOptimalVideoSource(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";const{isMobile:o,isTablet:i,isDesktop:r,isLowPower:a}=this.deviceInfo,{effectiveType:n,downlink:s,saveData:d}=this.networkInfo,{batteryOptimization:l}=this.userBehavior;let c="mobile";!i||a||d||(c="tablet"),r&&!l&&s>5&&(c="desktop"),"slow-2g"===n||"2g"===n?c="mobile":"3g"===n&&"desktop"===c&&(c="tablet");const h=document.createElement("video");let v="mp4";return""!==h.canPlayType("video/webm")&&s>2&&(v="webm"),""!==h.canPlayType('video/webm; codecs="av01.0.05M.08"')&&s>5&&!a&&"high"===t&&(v="av1"),{src:"/videos/".concat(e,"-").concat(c,".").concat("av1"===v?"av1.mp4":v),quality:c,format:v,poster:"/videos/".concat(e,"-poster.jpg")}}async preloadVideo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";if(this.preloadedVideos.has(e))return this.preloadedVideos.get(e);if(!this.shouldPreload(t))return null;const o=this.getOptimalVideoSource(e,t);try{const t=document.createElement("video");t.preload="metadata",t.muted=!0,t.playsInline=!0;const i=new Promise((e,i)=>{const r=setTimeout(()=>{i(new Error("Preload timeout"))},1e4);t.addEventListener("loadedmetadata",()=>{clearTimeout(r),e({video:t,source:o,preloadedAt:Date.now()})},{once:!0}),t.addEventListener("error",()=>{clearTimeout(r),i(new Error("Video preload failed"))},{once:!0})});t.src=o.src;const r=await i;return this.preloadedVideos.set(e,r),this.cleanupOldPreloads(),r}catch(i){return console.warn("Failed to preload video ".concat(e,":"),i),null}}shouldPreload(e){const{effectiveType:t,saveData:o,downlink:i}=this.networkInfo,{isLowPower:r}=this.deviceInfo,{batteryOptimization:a}=this.userBehavior;return!o&&"slow-2g"!==t&&"2g"!==t&&(a?"high"===e:r?"high"===e&&i>2:"4g"===t&&i>5||("3g"===t||i>2)&&"low"!==e)}cleanupOldPreloads(){const e=this.deviceInfo.isLowPower?3:6,t=Date.now(),o=Array.from(this.preloadedVideos.entries());if(o.forEach(e=>{let[o,i]=e;t-i.preloadedAt>3e5&&(this.preloadedVideos.delete(o),i.video&&(i.video.src="",i.video.load()))}),this.preloadedVideos.size>e){o.sort((e,t)=>e[1].preloadedAt-t[1].preloadedAt).slice(0,this.preloadedVideos.size-e).forEach(e=>{let[t,o]=e;this.preloadedVideos.delete(t),o.video&&(o.video.src="",o.video.load())})}}async preloadCriticalVideos(){if(!this.shouldPreload("normal"))return;const e=["dji-20240806130059-0020-d","dji-20240806130609-0022-d"].map(e=>this.preloadVideo(e,"high"));try{await Promise.allSettled(e)}catch(t){console.warn("Some critical videos failed to preload:",t)}}async preloadOnScroll(e,t){if(!this.shouldPreload("normal"))return;const o=t.slice(0,2).map(e=>this.preloadVideo(e,"normal"));await Promise.allSettled(o)}getPreloadedVideo(e){return this.preloadedVideos.get(e)}trackUserInteraction(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(0,i.A)({timestamp:Date.now(),eventType:e,videoId:t},o);this.userBehavior.interactionPatterns.push(r),this.userBehavior.interactionPatterns.length>100&&(this.userBehavior.interactionPatterns=this.userBehavior.interactionPatterns.slice(-100)),localStorage.setItem("video_user_behavior",JSON.stringify(this.userBehavior))}getPerformanceMetrics(){return{preloadedCount:this.preloadedVideos.size,networkType:this.networkInfo.effectiveType,deviceType:this.deviceInfo.isMobile?"mobile":this.deviceInfo.isTablet?"tablet":"desktop",batteryOptimization:this.userBehavior.batteryOptimization,memoryUsage:.5*this.preloadedVideos.size}}}}}]);
//# sourceMappingURL=416.6ae88ca1.chunk.js.map